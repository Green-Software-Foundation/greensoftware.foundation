---
interface Logo {
  name: string;
  logo: string;
  website: string;
}

interface Props {
  /** Heading text above the marquee */
  heading?: string;
  /** Array of logo data. If not provided, loads from logos.json */
  logos?: Logo[];
  /** Background class for the section */
  bgClass?: string;
  /** Background class for the gradient fade edges */
  fadeBgClass?: string;
  /** Whether logos should be greyscale by default */
  greyscale?: boolean;
}

const {
  heading = "ISO-accredited and endorsed by leading technology organizations",
  logos: propLogos,
  bgClass = "bg-white",
  fadeBgClass,
  greyscale = false,
} = Astro.props;

const logos: Logo[] = propLogos || (await import("../data/logos.json")).default;
const marqueeDuration = Math.max(logos.length * 3, 30);

// Determine the gradient "from" color based on background
const fadeFrom = fadeBgClass || (bgClass.includes("accent-lightest-2") ? "from-accent-lightest-2" : "from-white");
---

<section class={`py-12 md:py-16 ${bgClass}`} style={`--marquee-duration: ${marqueeDuration}s`}>
  <div class="relative container overflow-hidden">
    <p class="mb-6 text-center text-sm font-medium text-gray-darker md:mb-8">
      {heading}
    </p>
    <div class="relative flex items-center overflow-hidden">
      <div class={`absolute top-0 bottom-0 left-0 z-10 w-20 bg-gradient-to-r ${fadeFrom} to-transparent`}></div>
      <div class={`absolute top-0 right-0 bottom-0 z-10 w-20 bg-gradient-to-l ${fadeFrom} to-transparent`}></div>
      {[0, 1].map(() => (
        <div class="flex shrink-0 animate-marquee items-center gap-12">
          {logos.map((logo) => (
            <a
              href={`//${logo.website.replace(/^https?:\/\//, '').replace(/^www\./, '')}`}
              target="_blank"
              rel="noopener noreferrer"
              class:list={[
                "mx-6 flex h-12 w-32 shrink-0 items-center justify-center md:h-14 md:w-40",
                greyscale && "grayscale opacity-60 transition-all duration-300 hover:grayscale-0 hover:opacity-100",
              ]}
            >
              <img
                class="max-h-full max-w-full object-contain"
                src={logo.logo}
                alt={logo.name}
                loading="lazy"
              />
            </a>
          ))}
        </div>
      ))}
    </div>
  </div>
</section>
