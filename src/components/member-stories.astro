---
import { Button } from "@/components/ui/button";

interface StoryOrg {
  /** Organisation name */
  name: string;
  /** Organisation logo (if present, replaces text) */
  logoSrc?: string;
}

interface Story {
  /** Story title */
  title: string;
  /** Short summary */
  description: string;
  /** Organisations involved */
  organizations?: StoryOrg[];
  /** Story thumbnail/hero image */
  imageSrc?: string;
  /** Link to the full story */
  href?: string;
  /** CTA text */
  cta?: string;
}

interface Props {
  /** Heading text. Wrap words in *asterisks* for accent colour */
  heading?: string;
  /** Body text under heading */
  body?: string;
  /** Array of story cards */
  stories?: Story[];
  /** Footer CTA text */
  footerCtaText?: string;
  /** Footer CTA href */
  footerCtaHref?: string;
  /** Background class */
  bgClass?: string;
}

const {
  heading = "",
  body,
  stories = [],
  footerCtaText,
  footerCtaHref = "#",
  bgClass = "bg-accent-lightest-2",
} = Astro.props;

// Split heading into plain and accent segments
const headingParts = heading.split(/(\*[^*]+\*)/g).filter(Boolean).map(part => {
  if (part.startsWith("*") && part.endsWith("*")) {
    return { text: part.slice(1, -1), accent: true };
  }
  return { text: part, accent: false };
});
---

<section class={`py-16 md:py-20 ${bgClass}`}>
  <div class="container">
    <div class="mx-auto max-w-5xl text-center">
      <h2 class="text-2xl font-semibold md:text-3xl lg:text-4xl">
        {headingParts.map(part =>
          part.accent
            ? <span class="font-bold text-primary">{part.text}</span>
            : part.text
        )}
      </h2>
      {body && (
        <p class="mt-4 text-lg leading-relaxed md:text-xl">{body}</p>
      )}
    </div>

    <div class="mt-10 grid grid-cols-1 gap-6 md:grid-cols-2">
      {stories.map((story) => (
        <a href={story.href || "#"} class="group flex flex-col overflow-hidden rounded-xl border bg-white shadow-sm transition-shadow hover:shadow-md">
          {story.imageSrc && (
            <div class="aspect-[16/9] overflow-hidden bg-gray-light">
              <img
                src={story.imageSrc}
                alt={story.title}
                class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
              />
            </div>
          )}
          <div class="flex flex-1 flex-col justify-between p-6">
            <div>
              {story.organizations && story.organizations.length > 0 && (
                <div class="mb-3 flex items-center gap-3 text-sm">
                  {story.organizations.map((org, i) => (
                    <>
                      {i > 0 && <span class="text-gray-dark">&times;</span>}
                      {org.logoSrc ? (
                        <img
                          src={org.logoSrc}
                          alt={org.name}
                          class="h-5 w-auto"
                        />
                      ) : (
                        <span class="font-semibold text-primary">{org.name}</span>
                      )}
                    </>
                  ))}
                </div>
              )}
              <h3 class="mb-2 text-xl font-bold leading-tight">{story.title}</h3>
              <p class="text-sm text-gray-darker">{story.description}</p>
            </div>
            <span class="mt-4 inline-flex items-center text-sm font-bold text-primary group-hover:underline">
              {story.cta || "Read the story â†’"}
            </span>
          </div>
        </a>
      ))}
    </div>

    {footerCtaText && (
      <div class="mt-10 text-center">
        <a href={footerCtaHref}>
          <Button variant="primary" class="px-8 py-3 text-base">{footerCtaText}</Button>
        </a>
      </div>
    )}
  </div>
</section>
