---
import { Card } from "@/components/ui/card";
import LinkedInIcon from "@/assets/linkedin-icon.svg";

interface TeamMember {
  fullName: string;
  role: string;
  company?: string;
  photo?: string | null;
  socialMedia?: { platform: string; link: string }[];
  /** Optional label shown above the role, e.g. "Steering Committee Chair" */
  label?: string;
}

interface Props {
  /** Section heading. Wrap words in *asterisks* for accent colour. */
  heading?: string;
  /** Introductory body text */
  body?: string;
  /** Array of team members to display */
  members: TeamMember[];
  /** Optional highlighted members shown first in larger cards (e.g. Chair, Vice-Chair) */
  highlighted?: TeamMember[];
  /** Number of columns (2, 3, or 4) */
  columns?: 2 | 3 | 4;
  /** Background class */
  bgClass?: string;
}

const {
  heading = "",
  body = "",
  members = [],
  highlighted = [],
  columns = 3,
  bgClass = "bg-accent-lightest-2",
} = Astro.props;

// Parse heading accent segments
const headingParts = heading
  ? heading.split(/(\*[^*]+\*)/g).filter(Boolean).map(part => {
      if (part.startsWith("*") && part.endsWith("*")) {
        return { text: part.slice(1, -1), accent: true };
      }
      return { text: part, accent: false };
    })
  : [];

const colClasses: Record<number, string> = {
  2: "md:grid-cols-2",
  3: "md:grid-cols-2 lg:grid-cols-3",
  4: "md:grid-cols-2 lg:grid-cols-4",
};
---

<section class={`py-12 md:py-16 ${bgClass}`}>
  <div class="container">
    {heading && (
      <div class="mx-auto mb-8 max-w-3xl text-center">
        <h2 class="text-2xl font-semibold md:text-3xl lg:text-4xl">
          {headingParts.map(part =>
            part.accent
              ? <span class="font-bold text-primary">{part.text}</span>
              : part.text
          )}
        </h2>
        {body && (
          <p class="mt-4 text-lg leading-relaxed text-primary-dark/80">
            {body}
          </p>
        )}
      </div>
    )}

    {/* Highlighted members (Chair, Vice-Chair, etc.) */}
    {highlighted.length > 0 && (
      <div class="mx-auto mb-8 grid max-w-2xl grid-cols-1 gap-4 md:grid-cols-2">
        {highlighted.map((member) => {
          const linkedin = member.socialMedia?.find(s => s.platform === "Linkedin");
          return (
            <Card className="flex flex-col items-center p-8 text-center bg-primary-darker border-0">
              <div class="mb-4 flex size-28 items-center justify-center overflow-hidden rounded-full bg-primary-light/30">
                {member.photo ? (
                  <img src={member.photo} alt={member.fullName} class="size-full object-cover" />
                ) : (
                  <span class="text-3xl font-bold text-white/60">
                    {member.fullName.split(" ").map(n => n[0]).join("")}
                  </span>
                )}
              </div>
              {member.label && (
                <span class="mb-2 inline-block rounded-full bg-accent/20 px-3 py-1 text-xs font-bold text-accent">
                  {member.label}
                </span>
              )}
              <p class="text-lg font-bold text-white">{member.fullName}</p>
              <p class="mt-1 text-sm text-white/70">{member.role}</p>
              {member.company && (
                <p class="text-xs text-white/50">{member.company}</p>
              )}
              {linkedin && (
                <a href={linkedin.link} target="_blank" rel="noopener noreferrer" class="mt-3">
                  <LinkedInIcon class="text-accent" />
                </a>
              )}
            </Card>
          );
        })}
      </div>
    )}

    {/* Regular members grid */}
    {members.length > 0 && (
      <div class={`grid grid-cols-1 gap-4 ${colClasses[columns]}`}>
        {members.map((member) => {
          const linkedin = member.socialMedia?.find(s => s.platform === "Linkedin");
          return (
            <Card className="flex flex-col items-center p-6 text-center h-full justify-between">
              <div class="mb-4 flex size-20 items-center justify-center overflow-hidden rounded-full bg-primary-lightest-2">
                {member.photo ? (
                  <img src={member.photo} alt={member.fullName} class="size-full object-cover" />
                ) : (
                  <span class="text-xl font-bold text-primary/40">
                    {member.fullName.split(" ").map(n => n[0]).join("")}
                  </span>
                )}
              </div>
              {member.label && (
                <div class="mb-1 flex flex-wrap justify-center gap-1">
                  {member.label.split(", ").map(role => (
                    <span class="inline-block rounded-full bg-accent-lighter px-2 py-0.5 text-xs font-semibold text-primary-dark">
                      {role}
                    </span>
                  ))}
                </div>
              )}
              <p class="text-base font-bold">{member.fullName}</p>
              <p class="mt-1 text-sm text-gray-darker">{member.role}</p>
              {member.company && (
                <p class="text-xs text-gray-darker">{member.company}</p>
              )}
              {linkedin && (
                <a href={linkedin.link} target="_blank" rel="noopener noreferrer" class="mt-3">
                  <LinkedInIcon class="text-primary" />
                </a>
              )}
            </Card>
          );
        })}
      </div>
    )}
  </div>
</section>
