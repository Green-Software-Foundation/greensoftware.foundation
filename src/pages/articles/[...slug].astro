---
import { getCollection, render } from "astro:content";
import Layout from "@/layouts/showcase.astro";
import Navbar from "@/components/navbar.astro";
import Footer from "@/components/footer.astro";
import { navItems } from "@/lib/nav-items";

export async function getStaticPaths() {
  const articles = await getCollection("articles");
  return articles.map((article) => ({
    params: { slug: article.id },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content } = await render(article);

const formattedDate = new Date(article.data.date).toLocaleDateString("en-GB", {
  day: "numeric",
  month: "long",
  year: "numeric",
});
---

<Layout>
  <Navbar
    logoSrc="/assets/gsf-logo-full.svg"
    logoAlt="Green Software Foundation"
    logoHref="/"
    topBar="none"
    showSearch
    navItems={navItems}
    ctaText="Discuss your challenges"
    ctaHref="/membership/"
  />
  <article class="py-16 md:py-20 bg-white">
    <div class="container">
      <div class="max-w-3xl mx-auto">
        <!-- Breadcrumbs -->
        <nav aria-label="Breadcrumb" class="mb-8">
          <ol class="flex items-center gap-2 text-sm text-gray-darker">
            <li><a href="/" class="hover:text-primary transition-colors">Home</a></li>
            <li class="text-gray-dark">/</li>
            <li><a href="/articles/" class="hover:text-primary transition-colors">Articles</a></li>
            <li class="text-gray-dark">/</li>
            <li class="text-primary-dark truncate max-w-[300px]">{article.data.title}</li>
          </ol>
        </nav>

        <!-- Article header -->
        <header class="mb-12">
          {article.data.mainImage && (
            <img
              src={article.data.mainImage}
              alt={article.data.mainImageAlt || article.data.title}
              class="w-full rounded-lg mb-8"
            />
          )}
          <h1 class="text-4xl md:text-5xl font-extrabold text-primary mb-4">
            {article.data.title}
          </h1>
          <div class="flex flex-wrap items-center gap-4 text-gray-darker text-sm">
            <time datetime={article.data.date.toISOString()}>
              {formattedDate}
            </time>
            {article.data.originBlogName && (
              <span>
                Originally published on{" "}
                {article.data.publishedOriginUrl ? (
                  <a
                    href={article.data.publishedOriginUrl}
                    class="text-primary underline"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {article.data.originBlogName}
                  </a>
                ) : (
                  article.data.originBlogName
                )}
              </span>
            )}
          </div>
          {article.data.teaserText && (
            <p class="text-lg text-primary-dark mt-6 leading-relaxed">
              {article.data.teaserText}
            </p>
          )}
        </header>

        <!-- Article body -->
        <div class="prose prose-lg max-w-none">
          <Content />
        </div>

        <!-- Authors -->
        {article.data.authors && article.data.authors.length > 0 && (
          <footer class="mt-16 pt-8 border-t border-border">
            <h2 class="text-sm font-bold text-gray-darker uppercase tracking-wider mb-6">
              {article.data.authors.length === 1 ? "Author" : "Authors"}
            </h2>
            <div class="space-y-6">
              {article.data.authors.map((author) => (
                <div class="flex items-start gap-4">
                  {author.photo && (
                    <img
                      src={author.photo}
                      alt={author.fullName}
                      class="w-14 h-14 rounded-full object-cover"
                    />
                  )}
                  <div>
                    <p class="font-bold text-primary-dark">{author.fullName}</p>
                    {author.role && (
                      <p class="text-sm text-gray-darker">
                        {author.role}
                        {author.company && (
                          <span>
                            {" at "}
                            {author.companyWebsite ? (
                              <a
                                href={author.companyWebsite}
                                class="text-primary underline"
                                target="_blank"
                                rel="noopener noreferrer"
                              >
                                {author.company}
                              </a>
                            ) : (
                              author.company
                            )}
                          </span>
                        )}
                      </p>
                    )}
                    {author.socialMedia && (
                      <div class="flex gap-3 mt-1">
                        {author.socialMedia.map((social) => (
                          <a
                            href={social.link}
                            class="text-xs text-primary underline"
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            {social.platform}
                          </a>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </footer>
        )}

        <!-- Translators -->
        {article.data.translators && article.data.translators.length > 0 && (
          <div class="mt-8 pt-6 border-t border-border">
            <h2 class="text-sm font-bold text-gray-darker uppercase tracking-wider mb-4">
              {article.data.translators.length === 1 ? "Translator" : "Translators"}
            </h2>
            <div class="space-y-4">
              {article.data.translators.map((translator) => (
                <div class="flex items-center gap-3">
                  {translator.photo && (
                    <img
                      src={translator.photo}
                      alt={translator.fullName}
                      class="w-10 h-10 rounded-full object-cover"
                    />
                  )}
                  <div>
                    <p class="font-semibold text-primary-dark text-sm">{translator.fullName}</p>
                    {translator.role && (
                      <p class="text-xs text-gray-darker">{translator.role}{translator.company && ` at ${translator.company}`}</p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  </article>
  <Footer />
</Layout>
